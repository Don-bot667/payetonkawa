---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Connexion">
    <section class="py-16">
        <div class="max-w-md mx-auto px-4">
            <div class="bg-white rounded-2xl shadow-sm border p-8">
                <h1 class="text-2xl font-bold text-center mb-8">Connexion</h1>

                <form id="login-form" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input
                            type="email"
                            id="email"
                            required
                            placeholder="votre@email.com"
                            class="w-full border rounded-lg px-4 py-3 focus:ring-2 focus:ring-marron-600 focus:border-marron-600 outline-none"
                        />
                    </div>

                    <div id="error-message" class="text-red-600 text-sm hidden"></div>

                    <button type="submit" class="w-full btn-primary">
                        Se connecter
                    </button>
                </form>

                <p class="text-center text-gray-600 mt-6">
                    Pas encore de compte ?
                    <a href="/inscription" class="text-marron-600 hover:text-marron-700 font-medium">S'inscrire</a>
                </p>
            </div>
        </div>
    </section>
</Layout>

<script>
    import { login } from '../lib/auth';

    const form = document.getElementById('login-form') as HTMLFormElement;
    const errorDiv = document.getElementById('error-message');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = (document.getElementById('email') as HTMLInputElement).value;

        try {
            await login(email);
            window.location.href = '/compte';
        } catch (error) {
            if (errorDiv) {
                errorDiv.textContent = (error as Error).message;
                errorDiv.classList.remove('hidden');
            }
        }
    });
</script>
