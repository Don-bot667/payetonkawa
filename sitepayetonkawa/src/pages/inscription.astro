---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Inscription">
    <section class="py-16">
        <div class="max-w-md mx-auto px-4">
            <div class="bg-white rounded-2xl shadow-sm border p-8">
                <h1 class="text-2xl font-bold text-center mb-8">Creer un compte</h1>

                <form id="register-form" class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nom</label>
                            <input
                                type="text"
                                id="nom"
                                required
                                class="w-full border rounded-lg px-4 py-3 focus:ring-2 focus:ring-marron-600 focus:border-marron-600 outline-none"
                            />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Prenom</label>
                            <input
                                type="text"
                                id="prenom"
                                required
                                class="w-full border rounded-lg px-4 py-3 focus:ring-2 focus:ring-marron-600 focus:border-marron-600 outline-none"
                            />
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input
                            type="email"
                            id="email"
                            required
                            placeholder="votre@email.com"
                            class="w-full border rounded-lg px-4 py-3 focus:ring-2 focus:ring-marron-600 focus:border-marron-600 outline-none"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Telephone (optionnel)</label>
                        <input
                            type="tel"
                            id="telephone"
                            placeholder="06 12 34 56 78"
                            class="w-full border rounded-lg px-4 py-3 focus:ring-2 focus:ring-marron-600 focus:border-marron-600 outline-none"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Adresse (optionnel)</label>
                        <input
                            type="text"
                            id="adresse"
                            placeholder="123 Rue du Cafe, Paris"
                            class="w-full border rounded-lg px-4 py-3 focus:ring-2 focus:ring-marron-600 focus:border-marron-600 outline-none"
                        />
                    </div>

                    <div id="error-message" class="text-red-600 text-sm hidden"></div>

                    <button type="submit" class="w-full btn-primary">
                        Creer mon compte
                    </button>
                </form>

                <p class="text-center text-gray-600 mt-6">
                    Deja un compte ?
                    <a href="/connexion" class="text-marron-600 hover:text-marron-700 font-medium">Se connecter</a>
                </p>
            </div>
        </div>
    </section>
</Layout>

<script>
    import { register } from '../lib/auth';

    const form = document.getElementById('register-form') as HTMLFormElement;
    const errorDiv = document.getElementById('error-message');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const data = {
            nom: (document.getElementById('nom') as HTMLInputElement).value,
            prenom: (document.getElementById('prenom') as HTMLInputElement).value,
            email: (document.getElementById('email') as HTMLInputElement).value,
            telephone: (document.getElementById('telephone') as HTMLInputElement).value || undefined,
            adresse: (document.getElementById('adresse') as HTMLInputElement).value || undefined
        };

        try {
            await register(data);
            window.location.href = '/compte';
        } catch (error) {
            if (errorDiv) {
                errorDiv.textContent = (error as Error).message;
                errorDiv.classList.remove('hidden');
            }
        }
    });
</script>
